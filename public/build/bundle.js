var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function o(e){e.forEach(t)}function c(e){return"function"==typeof e}function a(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function i(e,t){e.appendChild(t)}function r(e,t,n){e.insertBefore(t,n||null)}function s(e){e.parentNode.removeChild(e)}function l(e){return document.createElement(e)}function u(e){return document.createTextNode(e)}function d(){return u(" ")}function f(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function h(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}let p;function g(e){p=e}const v=[],m=[],_=[],$=[],y=Promise.resolve();let b=!1;function x(e){_.push(e)}let k=!1;const O=new Set;function S(){if(!k){k=!0;do{for(let e=0;e<v.length;e+=1){const t=v[e];g(t),w(t.$$)}for(g(null),v.length=0;m.length;)m.pop()();for(let e=0;e<_.length;e+=1){const t=_[e];O.has(t)||(O.add(t),t())}_.length=0}while(v.length);for(;$.length;)$.pop()();b=!1,k=!1,O.clear()}}function w(e){if(null!==e.fragment){e.update(),o(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(x)}}const C=new Set;function E(e,t){-1===e.$$.dirty[0]&&(v.push(e),b||(b=!0,y.then(S)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function N(a,i,r,l,u,d,f=[-1]){const h=p;g(a);const v=i.props||{},m=a.$$={fragment:null,ctx:null,props:d,update:e,not_equal:u,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(h?h.$$.context:[]),callbacks:n(),dirty:f,skip_bound:!1};let _=!1;if(m.ctx=r?r(a,v,((e,t,...n)=>{const o=n.length?n[0]:t;return m.ctx&&u(m.ctx[e],m.ctx[e]=o)&&(!m.skip_bound&&m.bound[e]&&m.bound[e](o),_&&E(a,e)),t})):[],m.update(),_=!0,o(m.before_update),m.fragment=!!l&&l(m.ctx),i.target){if(i.hydrate){const e=function(e){return Array.from(e.childNodes)}(i.target);m.fragment&&m.fragment.l(e),e.forEach(s)}else m.fragment&&m.fragment.c();i.intro&&(($=a.$$.fragment)&&$.i&&(C.delete($),$.i(y))),function(e,n,a){const{fragment:i,on_mount:r,on_destroy:s,after_update:l}=e.$$;i&&i.m(n,a),x((()=>{const n=r.map(t).filter(c);s?s.push(...n):o(n),e.$$.on_mount=[]})),l.forEach(x)}(a,i.target,i.anchor),S()}var $,y;g(h)}function R(t){let n,c,a,p,g,v,m,_,$,y,b,x,k,O,S,w,C,E,N,R,T,D,L,J,A,j,I,M,P,q,B,Q,U,V,z,F,G;return{c(){n=l("label"),c=u("sender"),a=l("input"),p=d(),g=l("label"),v=u("receiver"),m=l("input"),_=d(),$=l("div"),y=u('my role is "'),b=u(t[0]),x=u('"'),k=d(),O=l("button"),O.textContent="start",S=d(),w=l("button"),w.textContent="Set Remote",C=d(),E=l("div"),N=l("div"),R=u("local"),T=l("textarea"),D=d(),L=l("div"),J=u("remote"),A=l("textarea"),j=d(),I=l("div"),M=u("iceCandidatesLocal"),P=l("textarea"),q=d(),B=l("div"),Q=u("iceCandidatesRemote"),U=l("textarea"),V=d(),z=l("video"),h(a,"type","radio"),h(a,"name","type"),a.__value="sender",a.value=a.__value,t[10][0].push(a),h(m,"type","radio"),h(m,"name","type"),m.__value="receiver",m.value=m.__value,t[10][0].push(m),z.playsInline=!0,z.autoplay=!0},m(e,o){r(e,n,o),i(n,c),i(n,a),a.checked=a.__value===t[0],r(e,p,o),r(e,g,o),i(g,v),i(g,m),m.checked=m.__value===t[0],r(e,_,o),r(e,$,o),i($,y),i($,b),i($,x),r(e,k,o),r(e,O,o),r(e,S,o),r(e,w,o),r(e,C,o),r(e,E,o),i(E,N),i(N,R),i(N,T),t[12](T),i(E,D),i(E,L),i(L,J),i(L,A),t[13](A),i(E,j),i(E,I),i(I,M),i(I,P),t[14](P),i(E,q),i(E,B),i(B,Q),i(B,U),t[15](U),r(e,V,o),r(e,z,o),t[16](z),F||(G=[f(a,"change",t[9]),f(m,"change",t[11]),f(O,"click",t[6]),f(w,"click",t[7]),f(U,"change",t[8])],F=!0)},p(e,[t]){1&t&&(a.checked=a.__value===e[0]),1&t&&(m.checked=m.__value===e[0]),1&t&&function(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}(b,e[0])},i:e,o:e,d(e){e&&s(n),t[10][0].splice(t[10][0].indexOf(a),1),e&&s(p),e&&s(g),t[10][0].splice(t[10][0].indexOf(m),1),e&&s(_),e&&s($),e&&s(k),e&&s(O),e&&s(S),e&&s(w),e&&s(C),e&&s(E),t[12](null),t[13](null),t[14](null),t[15](null),e&&s(V),e&&s(z),t[16](null),F=!1,o(G)}}}function T(e){console.log("ice state chage",e)}function D(e){console.log("ice gather change",e)}function L(e){console.log("channel closing",e)}function J(e){console.log("getting channel message",e)}function A(e,t,n){let o,c,a,i,r,s,l,u;var d={offerToReceiveVideo:!0};let f=[];function h(e){console.log("ice cand event",e),e.candidate?f.push(e.candidate):n(3,i.value=JSON.stringify(f),i)}function p(e){console.log("channel opening",e),"sender"===o&&setInterval((()=>u.send("hello there over the channel")),2e3)}return[o,c,a,i,r,l,async function(){if(s=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),s.addEventListener("icecandidate",h),s.onconnectionstatechange=T,s.onicegatheringstatechange=D,"sender"===o){u=s.createDataChannel("data"),u.onopen=p,u.onclose=L;const e=await navigator.mediaDevices.getUserMedia({video:!0});e.getTracks().forEach((t=>{s.addTrack(t,e),console.log("added all tracks",t,"to local",e)})),s.createOffer(d).then((e=>{n(1,c.value=JSON.stringify(e),c),s.setLocalDescription(e),new QR({target:document.body,props:{contents:JSON.stringify(e),label:"first offer sd"}})})),console.log("sent offer")}else if("receiver"===o){s.addEventListener("datachannel",(e=>{u=e.channel,u.onopen=p,u.onclose=L,u.onmessage=J}));const e=MediaStream();n(5,l.srcObject=e,l),s.addEventListener("track",(async t=>{console.log("got track event",t),e.addTrack(t.track,e)}));let t=new RTCSessionDescription(JSON.parse(a.value));s.setRemoteDescription(t),s.createAnswer().then((e=>{n(1,c.value=JSON.stringify(e),c),s.setLocalDescription(e)}))}},function(){s.setRemoteDescription(new RTCSessionDescription(JSON.parse(a.value)))},function(){JSON.parse(r.value).map((e=>{s.addIceCandidate(e)})),console.log("added all candidates"),console.log("peer is",s)},function(){o=this.__value,n(0,o)},[[]],function(){o=this.__value,n(0,o)},function(e){m[e?"unshift":"push"]((()=>{c=e,n(1,c)}))},function(e){m[e?"unshift":"push"]((()=>{a=e,n(2,a)}))},function(e){m[e?"unshift":"push"]((()=>{i=e,n(3,i)}))},function(e){m[e?"unshift":"push"]((()=>{r=e,n(4,r)}))},function(e){m[e?"unshift":"push"]((()=>{l=e,n(5,l)}))}]}return new class extends class{$destroy(){!function(e,t){const n=e.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}{constructor(e){super(),N(this,e,A,R,a,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
